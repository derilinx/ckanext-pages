{% set pages_total = pages|length %}
{% set action = '{0}_show'.format(type) %}

{% if pages %}
    {% set editor = h.get_wysiwyg_editor() %}

    {% for page in pages %}
        {% if id %} {# this is for orgs and groups #}
            {% set url = h.url_for(controller='ckanext.pages.controller:PagesController', action=action, id=id, page='/' + page.name) %}
        {% elif type == 'blog' %}
            {% set url = h.url_for(controller='ckanext.pages.controller:PagesController', action='blog_show', page='/' + page.name) %}
        {% else %}
            {% set url = h.url_for(controller='ckanext.pages.controller:PagesController', action='pages_show', page='/' + page.name) %}
        {% endif %}
        <div class="row">

            <div class="panel" style="padding:5px;">
                <div class="panel-body">
                    <h2 style="margin-top:-5px;">
                        <a href="{{ url }}">{{ page.title }}</a></h2>

                    {% if page.publish_date %}

                        <small>Published by {{ h.linked_user( page.user_id ) }}
                            on {{ h.render_datetime(page.publish_date) }}</small>
                    {% else %}
                        <small>Submitted by {{ h.linked_user( page.user_id ) }}</small>
                    {% endif %}

                    {% if featured or page.featured %}
                        <span class="label label-success">Featured</span>
                    {% endif %}


                    {% if page.content %}
                        {% if editor %}
                            <div>
                                {{ page.content|striptags|truncate }}
                            </div>
                        {% else %}
                            {{ h.markdown_extract(page.content) }}
                        {% endif %}
                    {% else %}
                        <p class="empty">{{ _('This page currently has no content') }}</p>
                    {% endif %}
                    <a style="margin-top:10px" class="btn btn-info" href="{{ url }}">Read more</a>
                </div>
            </div>


        </div>
    {% endfor %}

{% else %}
    {% if type == 'blog' %}
        <p class="empty">{{ _('There are currently no blog articles here') }}</p>
    {% else %}
        <p class="empty">{{ _('There are currently no pages here') }}</p>
    {% endif %}
{% endif %}
