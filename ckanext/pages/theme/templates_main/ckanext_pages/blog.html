{% extends 'page.html' %}

{% block breadcrumb_content %}
  <li><a href="/blog">Blog</a></li>
  {% if c.page.name != "home" %}
    <li class="active">{% link_for c.page.title|truncate(35), controller='ckanext.pages.controller:PagesController', action='blog_show', page='/' + c.page.name %}</li>
  {% endif %}
{% endblock %}

{% block bodytag %}{{ super() }} class="blog"{% endblock %}
{% block subtitle %}{{ c.page.title }}{% endblock %}

{% block primary_content %}
    <style>
    .secondary {
            float: right !important;
            padding: 10px;
        }

        .module {
            float: left !important;
        }

        .dataset-item {
            border-right: none !important;
        }

{#        .wrapper {#}
{#            background-color: #EEEEEE !important;#}
{#        }#}
{##}
{#        .primary {#}
{#            background-color: #EEEEEE !important;#}
{#        }#}
{##}
{#        .module-content {#}
{#            background-color: #EEEEEE !important;#}
{#        }#}

        .wrapper::before {
            display: none;
        }

        .secondary {
            margin-top: 15px;
        }
    </style>
  <section class="module-content">
    {% if h.check_access('ckanext_pages_update') %}
      {% link_for _('Edit'), controller='ckanext.pages.controller:PagesController', action='blog_edit', page='/' + c.page.name, class_='btn btn-primary pull-right', icon='edit' %}
    {% endif %}
    <h1 class="page-heading">{{ c.page.title }}</h1>
      {% if c.page.publish_date %}
         <span class="muted date"> {{ h.render_datetime(c.page.publish_date) }} </span>
      {% endif %}
    {% if c.page.content %}
      {% set editor = h.get_wysiwyg_editor() %}
      {% if editor %}
        <div>
            {{c.page.content|safe}}
        </div>
      {% else %}
        {{ h.render_content(c.page.content) }}
      {% endif %}
    {% else %}
      <p class="empty">{{ _('This page currently has no content') }}</p>
    {% endif %}
  </section>
{% endblock %}

{% block secondary_content %}
{% set posts = h.get_recent_blog_posts(number=5, exclude=c.page.name) %}

  <div class="module module-narrow module-shallow">

    <div class="module-content">
            <div class="panel panel-info">
        <div class="panel-heading">Latest News</div>
        <div class="panel-body">
            {% for post in h.get_recent_blog_posts(number=5) %}
                <div class="row post">
                    <div class="post-title col-md-12">
                        <h3><a href="/blog/{{ post.name }}">{{ post.title|truncate(40, end="â€¦") }}</a></h3>
                    </div>
                    <div class="post-meta col-md-12">

                        <small>Published on {{ h.render_datetime(post.publish_date) }}</small>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
    </div>
  </div>





{% resource 'ckanext-pages/blog' %}
{% endblock %}
